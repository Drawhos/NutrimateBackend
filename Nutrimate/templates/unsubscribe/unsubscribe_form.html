<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Desuscribirme - Nutrimate</title>
    <style>
      body{font-family:Arial,Helvetica,sans-serif;background:#f6f6f6;padding:30px}
      .card{max-width:520px;margin:30px auto;background:#fff;padding:20px;border-radius:8px;border:1px solid #eee}
      label{display:block;margin-bottom:8px;font-weight:600}
      input{width:100%;padding:10px;margin-bottom:12px;border-radius:4px;border:1px solid #ccc}
      button{padding:10px 16px;background:#4A90E2;color:#fff;border:none;border-radius:4px;cursor:pointer}
      .msg{padding:10px;margin-top:10px;border-radius:4px}
      .success{background:#e8f7ed;color:#0f5132}
      .error{background:#fdecea;color:#6b0b11}
    </style>
  </head>
  <body>
    <div class="card">
      <h2>Desuscribirme</h2>
      <p>Para confirmar tu desuscripci칩n introduce tu correo y tu contrase침a.</p>

      <form id="unsubscribe-form" method="post" action="/api/users/unsubscribe-by-credentials/">
        <label for="email">Correo electr칩nico</label>
        <input id="email" name="email" type="email" required />

        <label for="password">Contrase침a</label>
        <input id="password" name="password" type="password" required />

        <button type="submit">Desuscribirme</button>
      </form>

      <div id="result"></div>
    </div>

    <script>
      const form = document.getElementById('unsubscribe-form')
      const result = document.getElementById('result')

      form.addEventListener('submit', async (e) => {
        e.preventDefault()
        result.innerHTML = ''
        const data = {
          email: form.email.value,
          password: form.password.value
        }

        try {
          const resp = await fetch(form.action, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          })

          const json = await resp.json()
          const div = document.createElement('div')
          div.className = 'msg ' + (resp.ok ? 'success' : 'error')
          div.textContent = json.detail || JSON.stringify(json)
          result.appendChild(div)
        } catch (err) {
          const div = document.createElement('div')
          div.className = 'msg error'
          div.textContent = 'Error al enviar la solicitud'
          result.appendChild(div)
        }
      })
    </script>
  </body>
</html>
